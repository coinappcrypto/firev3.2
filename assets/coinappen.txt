import time
import random
from colorama import Fore, Style, init

init()

def simulate_scan():
    print(f"{Fore.CYAN}Initializing system scan for 'CoinApp.BLockChain.Index.js'...{Style.RESET_ALL}")
    time.sleep(1)
    sources = [
        "src/main.js", "scripts/util.js", "assets/config.json",
        "lib/framework.js", "CoinApp.BLockChain.Index.js", "docs/readme.md"
    ]
    for i in range(1, 101):
        source = random.choice(sources)
        status = "FOUND" if source == "CoinApp.BLockChain.Index.js" else "SCANNING"
        color = Fore.GREEN if status == "FOUND" else Fore.YELLOW
        print(f"Scanning {Fore.BLUE}{source}{Style.RESET_ALL}... {color}{status}{Style.RESET_ALL}")
        time.sleep(0.1)
        if status == "FOUND":
            break
    print(f"\n{Fore.GREEN}'CoinApp.BLockChain.Index.js' located successfully!{Style.RESET_ALL}")
    time.sleep(1)
    print(f"{Fore.CYAN}System is now connected to 'CoinApp.BLockChain.Index.js'.{Style.RESET_ALL}")
    time.sleep(1)

def generate_earnings(plan_name, min_amount, max_amount):
    earnings = random.randint(min_amount, max_amount)
    return f"{Fore.YELLOW}{plan_name}: {Fore.GREEN}${earnings}{Style.RESET_ALL}"

def display_earnings():
    print(f"{Fore.CYAN}Fetching earnings data from 'CoinApp.BLockChain.Index.js'...{Style.RESET_ALL}")
    time.sleep(1)
    plans = [
        ("1-Week Plan", 0, 998),
        ("1-Month Plan", 0, 9082),
        ("1-Year Plan", 0, 98627),
        ("Unlimited Plan", 0, 912768),
    ]
    for plan in plans:
        time.sleep(1)
        print(generate_earnings(plan[0], plan[1], plan[2]))
    print(f"\n{Fore.CYAN}All plans displayed successfully!{Style.RESET_ALL}")

simulate_scan()
display_earnings()